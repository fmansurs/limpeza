<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style>
    .container {
      display: flex;
      align-items: flex-start;
    }
    .image-container {
      margin-right: 20px;
    }
    .form-container {
      display: flex;
      flex-direction: column;
    }
    .text-container {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <h1></h1>
  <div class="container">
    <div class="image-container">
      <img id="originalImage" src="limpeza.png" alt="Imagem Anterior" width="461" height="174">
      <canvas id="processedImage" width="461" height="174" style="display: none;"></canvas>
    </div>
    <div class="form-container">
      <form id="dataForm">
        Nome: <input type="text" name="nome"><br>
        RG: <input type="text" name="rg"><br>
        <div id="prisoesContainer">
          <div class="prisao">
            Data da Prisão 1: <input type="date" name="data_prisao[]"><br>
            Crimes:
            <textarea name="crimes[]" rows="4"></textarea><br>
            Valor da Multa: <input type="text" name="valor_multa[]" onblur="formatarValorMulta(this)"><br>
          </div>
        </div>
        <button type="button" onclick="adicionarPrisao()">+</button><br>
        <button type="submit">Confirmar</button>
      </form>
      <div id="textContainer" class="text-container" style="display: none;"></div>
      <button id="copyButton">Copiar</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('dataForm');
    const originalImage = document.getElementById('originalImage');
    const processedImage = document.getElementById('processedImage');
    const textContainer = document.getElementById('textContainer');
    const copyButton = document.getElementById('copyButton');
    const prisoesContainer = document.getElementById('prisoesContainer');

    // Função para adicionar um novo campo de prisão
    function adicionarPrisao() {
      const prisaoIndex = prisoesContainer.children.length + 1;
      const prisaoDiv = document.createElement('div');
      prisaoDiv.className = 'prisao';
      prisaoDiv.innerHTML = `
        Data da Prisão ${prisaoIndex}: <input type="date" name="data_prisao[]"><br>
        Crimes:
        <textarea name="crimes[]" rows="4"></textarea><br>
        Valor da Multa: <input type="text" name="valor_multa[]" onblur="formatarValorMulta(this)"><br>
      `;
      prisoesContainer.appendChild(prisaoDiv);
    }

    // Função para formatar o valor da multa
    function formatarValorMulta(input) {
      let valor = input.value.replace(/\D/g, '');
      valor = parseInt(valor) * 1000;
      input.value = valor.toLocaleString('pt-BR');
    }

    form.addEventListener('submit', function(event) {
      event.preventDefault();

      const nome = form.elements.nome.value;
      const rg = form.elements.rg.value;

      const ctx = processedImage.getContext('2d');
      ctx.drawImage(originalImage, 0, 0, 461, 174);

      ctx.font = '16px "Courier New"';
      ctx.fillStyle = 'black';

      const positions = {
        nome: [30, 238],
        rg: [514, 238]
      };

      for (const [field, position] of Object.entries(positions)) {
        const value = eval(field);
        if (field === 'rg') {
          ctx.font = '12px "Courier New"'; // Mantém o tamanho da fonte de 12 para o RG
          ctx.fillText(value, position[0], position[1]);
          ctx.font = '16px "Courier New"'; // Restaura o tamanho da fonte para 16 após preencher o RG
        } else {
          ctx.fillText(value, position[0], position[1]);
        }
      }

      originalImage.style.display = 'none';
      processedImage.style.display = 'block';

      let textContent = `-----------------------------
⚖️ LIMPEZA DE FICHA ⚖️
-----------------------------

NOME: ${nome}
RG: ${rg}

`;

      const dataPrisaoInputs = form.elements['data_prisao[]'];
      const crimesTextareas = form.elements['crimes[]'];
      const valorMultaInputs = form.elements['valor_multa[]'];

      let valorTotalMultas = 0;

      for (let i = 0; i < dataPrisaoInputs.length; i++) {
        const dataPrisao = formatarData(dataPrisaoInputs[i].value);
        const crimes = crimesTextareas[i].value;
        const valorMulta = valorMultaInputs[i].value;

        textContent += `
PRISÃO ${i + 1} | DATA: ${dataPrisao}
CRIMES:
${crimes}
Valor da Multa: R$${valorMulta}
━━━━━━━━━━━━━━━━
`;

        valorTotalMultas += parseFloat(valorMulta.replace(/\./g, ''));
      }

      textContent += `Valor Total das Multas: R$${formatarValor(valorTotalMultas)}`;

      textContainer.innerHTML = textContent;
      textContainer.style.display = 'block';
    });

    // Função para formatar a data no formato "dd/mm/aaaa"
    function formatarData(data) {
      const partes = data.split('-');
      return `${partes[2]}/${partes[1]}/${partes[0]}`;
    }

    // Função para formatar o valor com separador de milhares
    function formatarValor(valor) {
      return valor.toLocaleString('pt-BR');
    }

    copyButton.addEventListener('click', function() {
      const textToCopy = '```' + textContainer.innerHTML.replace(/<br>/g, '\n').replace(/&nbsp;/g, ' ') + '```';
      navigator.clipboard.writeText(textToCopy)
        .then(function() {
          alert('Texto copiado para a área de transferência!');
        })
        .catch(function(error) {
          console.error('Erro ao copiar o texto:', error);
        });
    });
  </script>
</body>
</html>